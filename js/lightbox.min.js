"use strict";function Lightbox(){var CTX=this,isIE8=false,isIE9=false,body=document.getElementsByTagName("body")[0],template='<div class="jslghtbx-contentwrapper" id="jslghtbx-contentwrapper" ></div>',imgRatio=false,currGroup=false,currThumbnail=false,currImage={},currImages=[],isOpen=false,animationEl,animationInt,animationChildren=[],animationTimeout,nextBtn=false,prevBtn=false,maxWidth,maxHeight,newImgWidth,newImgHeight;CTX.opt={};CTX.box=false;CTX.wrapper=false;CTX.thumbnails=[];function getHeight(){return window.innerHeight||document.documentElement.offsetHeight}function getWidth(){return window.innerWidth||document.documentElement.offsetWidth}function addEvent(el,e,callback,capture){if(el.addEventListener){el.addEventListener(e,callback,capture||false)}else if(el.attachEvent){el.attachEvent("on"+e,callback)}}function hasClass(el,className){if(!el||!className){return}return new RegExp("(^|\\s)"+className+"(\\s|$)").test(el.className)}function removeClass(el,className){if(!el||!className){return}el.className=el.className.replace(new RegExp("(?:^|\\s)"+className+"(?!\\S)"),"");return el}function addClass(el,className){if(!el||!className){return}if(!hasClass(el,className)){el.className+=" "+className}return el}function isset(obj){return typeof obj!=="undefined"}function getAttr(obj,attr){if(!obj||!isset(obj)){return false}var ret;if(obj.getAttribute){ret=obj.getAttribute(attr)}else if(obj.getAttributeNode){ret=obj.getAttributeNode(attr).value}if(isset(ret)&&ret!==""){return ret}return false}function hasAttr(obj,attr){if(!obj||!isset(obj)){return false}var ret;if(obj.getAttribute){ret=obj.getAttribute(attr)}else if(obj.getAttributeNode){ret=obj.getAttributeNode(attr).value}return typeof ret==="string"}function clckHlpr(i){addEvent(i,"click",function(e){stopPropagation(e);preventDefault(e);currGroup=getAttr(i,"data-jslghtbx-group")||false;currThumbnail=i;openBox(i,false,false,false)},false)}function stopPropagation(e){if(e.stopPropagation){e.stopPropagation()}else{e.returnValue=false}}function preventDefault(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function getByGroup(group){var arr=[];for(var i=0;i<CTX.thumbnails.length;i++){if(getAttr(CTX.thumbnails[i],"data-jslghtbx-group")===group){arr.push(CTX.thumbnails[i])}}return arr}function getPos(thumbnail,group){var arr=getByGroup(group);for(var i=0;i<arr.length;i++){if(getAttr(thumbnail,"src")===getAttr(arr[i],"src")&&getAttr(thumbnail,"data-jslghtbx-index")===getAttr(arr[i],"data-jslghtbx-index")&&getAttr(thumbnail,"data-jslghtbx")===getAttr(arr[i],"data-jslghtbx")){return i}}}function preload(){if(!currGroup){return}var prev=new Image;var next=new Image;var pos=getPos(currThumbnail,currGroup);if(pos===currImages.length-1){prev.src=currImages[currImages.length-1].src||getAttr(currImages[currImages.length-1],"data-src");next.src=currImages[0].src||getAttr(currImages[0].src,"data-src")}else if(pos===0){prev.src=currImages[currImages.length-1].src||getAttr(currImages[currImages.length-1],"data-src");next.src=currImages[1].src||getAttr(currImages[1],"data-src")}else{prev.src=currImages[pos-1].src||getAttr(currImages[pos-1],"data-src");next.src=currImages[pos+1].src||getAttr(currImages[pos+1],"data-src")}}function startAnimation(){if(isIE8){return}stopAnimation();var fnc=function(){addClass(CTX.box,"jslghtbx-loading");if(!isIE9&&typeof CTX.opt.loadingAnimation==="number"){var index=0;animationInt=setInterval(function(){addClass(animationChildren[index],"jslghtbx-active");setTimeout(function(){removeClass(animationChildren[index],"jslghtbx-active")},CTX.opt.loadingAnimation);index=index>=animationChildren.length?0:index+=1},CTX.opt.loadingAnimation)}};animationTimeout=setTimeout(fnc,500)}function stopAnimation(){if(isIE8){return}removeClass(CTX.box,"jslghtbx-loading");if(!isIE9&&typeof CTX.opt.loadingAnimation!=="string"&&CTX.opt.loadingAnimation){clearInterval(animationInt);for(var i=0;i<animationChildren.length;i++){removeClass(animationChildren[i],"jslghtbx-active")}}}function initControls(){if(!nextBtn){nextBtn=document.createElement("span");addClass(nextBtn,"jslghtbx-next");if(CTX.opt.nextImg){var nextBtnImg=document.createElement("img");nextBtnImg.setAttribute("src",CTX.opt.nextImg);nextBtn.appendChild(nextBtnImg)}else{addClass(nextBtn,"jslghtbx-no-img")}addEvent(nextBtn,"click",function(e){stopPropagation(e);CTX.next()},false);CTX.box.appendChild(nextBtn)}addClass(nextBtn,"jslghtbx-active");if(!prevBtn){prevBtn=document.createElement("span");addClass(prevBtn,"jslghtbx-prev");if(CTX.opt.prevImg){var prevBtnImg=document.createElement("img");prevBtnImg.setAttribute("src",CTX.opt.prevImg);prevBtn.appendChild(prevBtnImg)}else{addClass(prevBtn,"jslghtbx-no-img")}addEvent(prevBtn,"click",function(e){stopPropagation(e);CTX.prev()},false);CTX.box.appendChild(prevBtn)}addClass(prevBtn,"jslghtbx-active")}function repositionControls(){if(CTX.opt.responsive&&nextBtn&&prevBtn){var btnTop=getHeight()/2-nextBtn.offsetHeight/2;nextBtn.style.top=btnTop+"px";prevBtn.style.top=btnTop+"px"}}function setOpt(opt){if(!opt){opt={}}function setTrueDef(val){return typeof val==="boolean"?val:true}CTX.opt={boxId:opt.boxId||false,controls:setTrueDef(opt.controls),dimensions:setTrueDef(opt.dimensions),captions:setTrueDef(opt.captions),prevImg:typeof opt.prevImg==="string"?opt.prevImg:false,nextImg:typeof opt.nextImg==="string"?opt.nextImg:false,hideCloseBtn:opt.hideCloseBtn||false,closeOnClick:typeof opt.closeOnClick==="boolean"?opt.closeOnClick:true,loadingAnimation:opt.loadingAnimation===undefined?true:opt.loadingAnimation,animElCount:opt.animElCount||4,preload:setTrueDef(opt.preload),carousel:setTrueDef(opt.carousel),animation:typeof opt.animation==="number"||opt.animation===false?opt.animation:400,nextOnClick:setTrueDef(opt.nextOnClick),responsive:setTrueDef(opt.responsive),maxImgSize:opt.maxImgSize||.8,keyControls:setTrueDef(opt.keyControls),hideOverflow:opt.hideOverflow||true,onopen:opt.onopen||false,onclose:opt.onclose||false,onload:opt.onload||false,onresize:opt.onresize||false,onloaderror:opt.onloaderror||false};if(CTX.opt.boxId){CTX.box=document.getElementById(CTX.opt.boxId)}else if(!CTX.box&&!document.getElementById("jslghtbx")){var newEl=document.createElement("div");newEl.setAttribute("id","jslghtbx");newEl.setAttribute("class","jslghtbx");CTX.box=newEl;body.appendChild(CTX.box)}CTX.box.innerHTML=template;if(isIE8){addClass(CTX.box,"jslghtbx-ie8")}CTX.wrapper=document.getElementById("jslghtbx-contentwrapper");if(!CTX.opt.hideCloseBtn){var closeBtn=document.createElement("span");closeBtn.setAttribute("id","jslghtbx-close");closeBtn.setAttribute("class","jslghtbx-close");closeBtn.innerHTML="X";CTX.box.appendChild(closeBtn);addEvent(closeBtn,"click",function(e){stopPropagation(e);CTX.close()},false)}if(!isIE8&&CTX.opt.closeOnClick){addEvent(CTX.box,"click",function(e){stopPropagation(e);CTX.close()},false)}if(typeof CTX.opt.loadingAnimation==="string"){animationEl=document.createElement("img");animationEl.setAttribute("src",CTX.opt.loadingAnimation);addClass(animationEl,"jslghtbx-loading-animation");CTX.box.appendChild(animationEl)}else if(CTX.opt.loadingAnimation){CTX.opt.loadingAnimation=typeof CTX.opt.loadingAnimation==="number"?CTX.opt.loadingAnimation:200;animationEl=document.createElement("div");addClass(animationEl,"jslghtbx-loading-animation");var i=0;while(i<CTX.opt.animElCount){animationChildren.push(animationEl.appendChild(document.createElement("span")));i++}CTX.box.appendChild(animationEl)}if(CTX.opt.responsive){addEvent(window,"resize",function(){CTX.resize()},false);addClass(CTX.box,"jslghtbx-nooverflow")}else{removeClass(CTX.box,"jslghtbx-nooverflow")}if(CTX.opt.keyControls){addEvent(document,"keydown",function(e){if(isOpen){stopPropagation(e);if(e.keyCode===39){CTX.next()}else if(e.keyCode===37){CTX.prev()}else if(e.keyCode===27){CTX.close()}}},false)}}function openBox(el,group,cb,event){if(!el&&!group){return false}currGroup=group||currGroup||getAttr(el,"data-jslghtbx-group");if(currGroup){currImages=getByGroup(currGroup);if(typeof el==="boolean"&&!el){el=currImages[0]}}currImage.img=new Image;currThumbnail=el;var src;if(typeof el==="string"){src=el}else if(getAttr(el,"data-jslghtbx")){src=getAttr(el,"data-jslghtbx")}else{src=getAttr(el,"src")}imgRatio=false;if(!isOpen){if(typeof CTX.opt.animation==="number"){addClass(currImage.img,"jslghtbx-animate-transition jslghtbx-animate-init")}isOpen=true;if(CTX.opt.onopen){CTX.opt.onopen()}}if(!CTX.opt||!isset(CTX.opt.hideOverflow)||CTX.opt.hideOverflow){body.setAttribute("style","overflow: hidden")}CTX.box.setAttribute("style","padding-top: 0");CTX.wrapper.innerHTML="";CTX.wrapper.appendChild(currImage.img);if(CTX.opt.animation){addClass(CTX.wrapper,"jslghtbx-animate")}var captionText=getAttr(el,"data-jslghtbx-caption");if(captionText&&CTX.opt.captions){var caption=document.createElement("p");caption.setAttribute("class","jslghtbx-caption");caption.innerHTML=captionText;CTX.wrapper.appendChild(caption)}addClass(CTX.box,"jslghtbx-active");if(isIE8){addClass(CTX.wrapper,"jslghtbx-active")}if(CTX.opt.controls&&currImages.length>1){initControls();repositionControls()}currImage.img.onerror=function(){if(CTX.opt.onloaderror){CTX.opt.onloaderror(event)}};currImage.img.onload=function(){currImage.originalWidth=this.naturalWidth||this.width;currImage.originalHeight=this.naturalHeight||this.height;if(isIE8||isIE9){var dummyImg=new Image;dummyImg.setAttribute("src",src);currImage.originalWidth=dummyImg.width;currImage.originalHeight=dummyImg.height}var checkClassInt=setInterval(function(){if(hasClass(CTX.box,"jslghtbx-active")){addClass(CTX.wrapper,"jslghtbx-wrapper-active");if(typeof CTX.opt.animation==="number"){addClass(currImage.img,"jslghtbx-animate-transition")}if(cb){cb()}stopAnimation();clearTimeout(animationTimeout);if(CTX.opt.preload){preload()}if(CTX.opt.nextOnClick){addClass(currImage.img,"jslghtbx-next-on-click");addEvent(currImage.img,"click",function(e){stopPropagation(e);CTX.next()},false)}if(CTX.opt.onload){CTX.opt.onload(event)}clearInterval(checkClassInt);CTX.resize()}},10)};currImage.img.setAttribute("src",src);startAnimation()}CTX.load=function(opt){if(~navigator.appVersion.indexOf("MSIE 8")){isIE8=true}if(~navigator.appVersion.indexOf("MSIE 9")){isIE9=true}setOpt(opt);var arr=document.querySelectorAll("[data-jslghtbx]");for(var i=0;i<arr.length;i++){if(hasAttr(arr[i],"data-jslghtbx")){arr[i].setAttribute("data-jslghtbx-index",i);CTX.thumbnails.push(arr[i]);clckHlpr(arr[i])}}};CTX.open=function(el,group){if(el&&group){group=false}openBox(el,group,false,false)};CTX.resize=function(){if(!currImage.img){return}maxWidth=getWidth();maxHeight=getHeight();var boxWidth=CTX.box.offsetWidth;var boxHeight=CTX.box.offsetHeight;if(!imgRatio&&currImage.img&&currImage.img.offsetWidth&&currImage.img.offsetHeight){imgRatio=currImage.img.offsetWidth/currImage.img.offsetHeight}if(Math.floor(boxWidth/imgRatio)>boxHeight){newImgWidth=boxHeight*imgRatio;newImgHeight=boxHeight}else{newImgWidth=boxWidth;newImgHeight=boxWidth/imgRatio}newImgWidth=Math.floor(newImgWidth*CTX.opt.maxImgSize);newImgHeight=Math.floor(newImgHeight*CTX.opt.maxImgSize);if(CTX.opt.dimensions&&newImgHeight>currImage.originalHeight||CTX.opt.dimensions&&newImgWidth>currImage.originalWidth){newImgHeight=currImage.originalHeight;newImgWidth=currImage.originalWidth}currImage.img.style.width=newImgWidth+"px";currImage.img.style.height=newImgHeight+"px";currImage.img.style.marginTop=(getHeight()-newImgHeight)/2+"px";setTimeout(repositionControls,200);if(CTX.opt.onresize){CTX.opt.onresize()}};CTX.next=function(){if(!currGroup){return}var pos=getPos(currThumbnail,currGroup)+1;if(currImages[pos]){currThumbnail=currImages[pos]}else if(CTX.opt.carousel){currThumbnail=currImages[0]}else{return}if(typeof CTX.opt.animation==="number"){removeClass(currImage.img,"jslghtbx-animating-next");setTimeout(function(){var cb=function(){setTimeout(function(){addClass(currImage.img,"jslghtbx-animating-next")},CTX.opt.animation/2)};openBox(currThumbnail,false,cb,"next")},CTX.opt.animation/2)}else{openBox(currThumbnail,false,false,"next")}};CTX.prev=function(){if(!currGroup){return}var pos=getPos(currThumbnail,currGroup)-1;if(currImages[pos]){currThumbnail=currImages[pos]}else if(CTX.opt.carousel){currThumbnail=currImages[currImages.length-1]}else{return}if(typeof CTX.opt.animation==="number"){removeClass(currImage.img,"jslghtbx-animating-prev");setTimeout(function(){var cb=function(){setTimeout(function(){addClass(currImage.img,"jslghtbx-animating-next")},CTX.opt.animation/2)};openBox(currThumbnail,false,cb,"prev")},CTX.opt.animation/2)}else{openBox(currThumbnail,false,false,"prev")}};CTX.close=function(){currGroup=false;currThumbnail=false;currImage={};currImages=[];isOpen=false;removeClass(CTX.box,"jslghtbx-active");removeClass(CTX.wrapper,"jslghtbx-wrapper-active");removeClass(nextBtn,"jslghtbx-active");removeClass(prevBtn,"jslghtbx-active");CTX.box.setAttribute("style","padding-top: 0px");stopAnimation();if(isIE8){CTX.box.setAttribute("style","display: none")}if(!CTX.opt||!isset(CTX.opt.hideOverflow)||CTX.opt.hideOverflow){body.setAttribute("style","overflow: auto")}if(CTX.opt.onclose){CTX.opt.onclose()}}}